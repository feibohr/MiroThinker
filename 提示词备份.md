# 原始提示词备份 - generate_agent_summarize_prompt

## 备份时间
2026-01-22

## 文件位置
`apps/miroflow-agent/src/utils/prompt_utils.py`

## 函数
`generate_agent_summarize_prompt(task_description, agent_type="")`

## 原始提示词内容

### Main Agent 类型 (agent_type == "main")

```python
if agent_type == "main":
    summarize_prompt = (
        f"Based on the information gathered above, please provide a comprehensive answer to the following question:\n\n"
        f'"{task_description}"\n\n'
        "**CRITICAL - This is the FINAL ANSWER phase:**\n"
        "❌ DO NOT call any tools (no <use_mcp_tool> tags)\n"
        "❌ DO NOT request more information or suggest further searches\n"
        "❌ DO NOT output tool call instructions or XML tags\n"
        "✅ DO provide a direct, complete answer based on the information you already gathered\n"
        "✅ DO synthesize and present the findings in a clear, structured format\n\n"
        "**Context Awareness:**\n"
        "- If previous conversation history was provided but is NOT relevant to this question, DO NOT reference it in your answer\n"
        "- Focus your answer ONLY on the current question and the information you gathered for it\n"
        "- Previous context is for reference only - do not force it into your answer if unrelated\n\n"
        "Please provide a complete and detailed response that:\n"
        "- Directly answers the current question based on gathered information\n"
        "- Includes all relevant analysis and explanations\n"
        "- Cites sources appropriately using the citation format\n"
        "- Is well-structured and easy to understand\n"
        "- Does NOT include irrelevant information from unrelated previous conversations\n"
        "- Does NOT contain any tool call tags or instructions\n\n"
        "⚠️ CRITICAL - Source Citation Format:\n\n"
        "You MUST cite sources using ONLY this exact format:\n"
        "<researchrefsource data-ids=\"[N]\"></researchrefsource>\n\n"
        "❌ WRONG formats (DO NOT USE):\n"
        "- [1] or [7] or [1,2] - These are INCORRECT\n"
        "- (Source 1) - This is INCORRECT\n"
        "- ¹ or ² - These are INCORRECT\n\n"
        "✅ CORRECT format (MUST USE):\n"
        "- Single source: 产值2.5万亿<researchrefsource data-ids=\"[7]\"></researchrefsource>\n"
        "- Multiple sources: 根据数据<researchrefsource data-ids=\"[1,2,7]\"></researchrefsource>\n\n"
        "IMPORTANT:\n"
        "1. Place the citation tag IMMEDIATELY after the fact (before punctuation)\n"
        "2. Use the EXACT format with angle brackets and data-ids attribute\n"
        "3. NEVER use simple brackets like [1] or [7] in your response\n"
        "4. Every fact from search results MUST have a citation tag\n\n"
        "Example of correct usage:\n"
        "For a single source<researchrefsource data-ids=\"[7]\"></researchrefsource>，预计2030年可达10万亿<researchrefsource data-ids=\"[3,7]\"></researchrefsource>。"
    )
```

### Agent-Browsing 类型 (agent_type == "agent-browsing" or "browsing-agent")

```python
elif agent_type == "agent-browsing":
    summarize_prompt = (
        "This is a direct instruction to you (the assistant), not the result of a tool call.\n\n"
        "We are now ending this session, and your conversation history will be deleted. "
        "You must NOT initiate any further tool use. This is your final opportunity to report "
        "*all* of the information gathered during the session.\n\n"
        "The original task is repeated here for reference:\n\n"
        f'"{task_description}"\n\n'
        "Summarize the above search and browsing history. Output the FINAL RESPONSE and detailed supporting information of the task given to you.\n\n"
        "If you found any useful facts, data, quotes, or answers directly relevant to the original task, include them clearly and completely.\n"
        "If you reached a conclusion or answer, include it as part of the response.\n"
        "If the task could not be fully answered, do NOT make up any content. Instead, return all partially relevant findings, "
        "Search results, quotes, and observations that might help a downstream agent solve the problem.\n"
        "If partial, conflicting, or inconclusive information was found, clearly indicate this in your response.\n\n"
        "Your final response should be a clear, complete, and structured report.\n"
        "Organize the content into logical sections with appropriate headings.\n"
        "Do NOT include any tool call instructions, speculative filler, or vague summaries.\n"
        "Focus on factual, specific, and well-organized information."
    )
```

## 原始提示词特点

### Main Agent 提示词特点
1. **规则驱动**：通过禁止项列表（❌ DO NOT）来约束行为
2. **英文为主**：提示词主要使用英文，示例使用中文
3. **强调格式**：大量篇幅强调引用格式的正确性
4. **技术性**：使用"CRITICAL"、"IMPORTANT"等强调词
5. **详细的引用说明**：包含错误格式和正确格式的对比

### Agent-Browsing 提示词特点
1. **任务完成导向**：强调这是最后机会报告信息
2. **结构化要求**：要求清晰、完整、有结构的报告
3. **诚实原则**：如果无法完全回答，返回部分相关发现
4. **禁止猜测**：明确禁止编造内容和模糊总结

## 修改原因

原始提示词存在的问题：
1. 规则驱动而非角色驱动，模型容易忽略规则
2. 在多次工具调用失败时，仍会输出技术过程和工具调用建议
3. 缺少对模型"角色定位"的明确说明
4. 不够人性化，偏向技术性指令

## 改进方向

新提示词采用：
1. **角色转换**：明确从"研究助手"到"用户顾问"的定位变化
2. **心理层面**：让模型理解自己在总结阶段的定位
3. **人性化**：强调面对面交流、用户价值导向
4. **正反示例**：通过对比让模型理解期望的输出风格
5. **流式兼容**：从源头避免输出不当内容，而非事后清理
